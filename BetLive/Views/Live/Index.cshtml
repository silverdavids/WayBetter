@{
    ViewBag.Title = "Live";
    Layout = "~/Views/Shared/_LiveLayoutPage.cshtml";
}
<style>
    .table thead > tr > th, .table tbody > tr > th, .table tfoot > tr > th, .table thead > tr > td, .table tbody > tr > td, .table tfoot > tr > td {
        border-top: 0; 
    }
    
</style>

<div>
    <div class="row">
        <div class="col-lg-12"><h2 class="heading">Live </h2></div>
        <div class="col-lg-9">
            
            <div id="gameTable">
                <table class="table table-condensed table-striped table-responsive oddstable" id="MatchTable">
                    <thead>
                        <tr><th colspan="5"></th><th colspan="3" class="text-center">Full&nbsp;Time</th><th colspan="3" class="text-center">Under/Over</th><th colspan="3" class="text-center">Double&nbsp;Chance&nbsp;</th><th colspan="3" class="text-center">Next&nbsp;Goal</th></tr>
                        <tr style="background-color:#0D1F35 !important; color: #ffffff;">
                            <th>Match No</th>
                            <th>Min</th>
                            <th>Home</th>
                            <th>Score</th>
                            <th>Away</th>
                            <th class="text-center">1</th>
                            <th class="text-center">X</th>
                            <th class="text-center">2</th>
                            <th class="text-center"><i class="fa fa-sort-down"></i>Under</th>
                            <th class="text-center">E-V</th>
                            <th class="text-center"><i class="fa fa-sort-up "></i>Over</th>
                            <th class="text-center">1X</th>
                            <th class="text-center">12</th>
                            <th class="text-center">X2</th>
                            <th class="text-center">1</th>
                            <th class="text-center">X</th>
                            <th class="text-center">2</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        @*<tr class="loading text-center"><td colspan="11">loading...</td></tr>*@
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-lg-3  pull-right">
           <!-- <div class="alert alert-info text-center">
                <span class="text-info"><i class="fa fa-info"></i> Receipt Section</span>-->
                @{
                    
                    @Html.Partial("Receipt");
                }
           <!-- </div>-->
        </div>
    </div>
</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        (function ($) {

            $.fn.extend({

                addTemporaryClass: function (className, duration) {
                    var elements = this;
                    setTimeout(function () {
                        elements.removeClass(className);
                    }, duration);

                    return this.each(function () {
                        $(this).addClass(className);
                    });
                }
            });

        })(jQuery);

        $(function () {
            // A simple templating method for replacing placeholders enclosed in curly braces.
            if (!String.prototype.supplant) {
                String.prototype.supplant = function (o) {
                    return this.replace(/{([^{}]*)}/g,
                        function (a, b) {
                            var r = o[b];
                            return typeof r === 'string' || typeof r === 'number' ? r : a;
                        }
                    );
                };
            }

            $(function () {

                var ticker = $.connection.liveBetHubAng,
                    $gameTable = $('#MatchTable'),
                    $gamesTableBody = $gameTable.find('#tbody');



                function init() {
                    ticker.server.testString().done(function (string) {
                        console.log(string);
                    });

                    // get all livescores
                    ticker.server.getAllGames().done(function (games) {
                        $gamesTableBody.empty();
                        console.log(games);
                        $.each(games, function () {

                            var game = this;
                            if (game.FullTimeOdds == null) {
                                game.FullTimeOdds = {
                                    AwayWins: "N/A",
                                    Draw: "N/A",
                                    HomeWins: "N/A"
                                };
                            }
                            if (game.DoubleChance == null) {
                                game.DoubleChance = {
                                    HomeWinsOrDraw : "N/A",
                                    HomeWinsOrAwayWins: "N/A",
                                    AwayWinsOrDraw: "N/A"
                                };
                            }
                            if (game.NextGoal == null) {
                                game.NextGoal = {
                                    AwayScores: "N/A",
                                    Draw: "N/A",
                                    HomeScores: "N/A"
                                };
                            }

                            if (game.UnderOverOdds == null) {
                                game.UnderOverOdds = {
                                    Under: "N/A",
                                    Over: "N/A",
                                    ExtraValue: "N/A"
                                };
                            }
                            var rowTemplate = ' <tr  data-symbol="' + game.MatchNo + '" id="' + game.MatchNo + '"> ' +

                                ' <td data-field="shortCode" class="short-code"> '+ game.ShortCode +' </td> ' +
                                ' <td data-field="matchId" class="match-code hidden">'+game.MatchNo +'</td> ' +
                                ' <td data-field="startTime" class="start-time">'+ game.Minutes +'</td> ' +
                                ' <td data-field="startDate" class="start-date hidden"> '+ game.StartDate+'</td> ' +
                                ' <td data-field="teamVersus" class="team-versus hidden">'+ game.LocalTeam +'  vs  '+ game.AwayTeam+'</td> ' +
                                ' <td>'+ game.LocalTeam +'</td> ' +
                                ' <td data-field="liveScores" class="live-scores">'+ game.LocalTeamScore +' - '+ game.AwayTeamScore +'</td> ' +
                                ' <td>'+ game.AwayTeam +'</td> ' +
                                ' <td style="padding-bottom: 0px;"> ' +
                                     ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+ game.FullTimeOdds.HomeWins +'" data-odd-type="Live" data-option-id="80" data-option-name=1" data-bet-category="FT1X2" /> ' + 
                                    
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+ game.FullTimeOdds.Draw +'" data-odd-type="Live" data-option-id="81" data-option-name="X" data-bet-category="FT1X2" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+ game.FullTimeOdds.AwayWins +'" data-odd-type="Live" data-option-id="83" data-option-name="2" data-bet-category="FT1X2" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default odd" value="'+ game.UnderOverOdds.Under +'" data-odd-type="Live" data-option-id="78" data-option-name="U" data-bet-category="U/O" /> ' +
                            '  </td> ' +
                            '<td id="' + game.MatchNo + '" data-extra-value="' + game.UnderOverOdds.ExtraValue + '"  style="padding-top: 14px;">' +
                                '  <span class="extra-value" style="color:#E9860D;">' + game.UnderOverOdds.ExtraValue + '</span>' +
                                '</td>' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default odd" value="'+ game.UnderOverOdds.Over +'" data-odd-type="Live" data-option-id="79" data-option-name="O" data-bet-category="U/O" /> ' +
                            '  </td> ' +
                             ' <td style="padding-bottom: 0px;"> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+game.DoubleChance.HomeWinsOrDraw+'" data-odd-type="Live" data-option-id="74" data-option-name="1X" data-bet-category="Double Chance" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+game.DoubleChance.HomeWinsOrAwayWins+'" data-odd-type="Live" data-option-id="71" data-option-name="12" data-bet-category="Double Chance" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+game.DoubleChance.AwayWinsOrDraw+'" data-odd-type="Live" data-option-id="77" data-option-name="X2" data-bet-category="Double Chance" /> ' +
                            '  </td> ' +
                             ' <td style="padding-bottom: 0px;"> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+game.NextGoal.HomeScores+'" data-odd-type="Live" data-option-id="71" data-option-name="H-GOAL" data-bet-category="FT1X2-NG" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+game.NextGoal.Draw+'" data-odd-type="Live" data-option-id="72" data-option-name="NG" data-bet-category="FT1X2-NG" /> ' +
                            '  </td> ' +
                             ' <td> ' +
                                 ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+game.NextGoal.AwayScores+'" data-odd-type="Live" data-option-id="73" data-option-name="A-GOAL" data-bet-category="FT1X2-NG" /> ' +
                            '  </td> ' +
                        ' </tr> ' ;
                            $gamesTableBody.append(rowTemplate);
                        });
                    });
                }

                // Add a client-side hub method that the server will call
                ticker.client.updateGame = function (game) {
                   // console.clear();
                   // console.log(game);
                    if (game.FullTimeOdds == null) {
                        game.FullTimeOdds = {
                            AwayWins: "N/A",
                            Draw: "N/A",
                            HomeWins: "N/A"
                        };
                    }
                    if (game.DoubleChance == null) {
                        game.DoubleChance = {
                            AwayWinsOrDraw: "N/A",
                            HomeWinsOrAwayWins: "N/A",
                            HomeWinsOrDraw: "N/A"
                        };  
                    }
                    if (game.NextGoal == null) {
                        game.NextGoal = {
                            AwayScores: "N/A",
                            Draw: "N/A",
                            HomeScores: "N/A"
                        };
                    }

                    if (game.UnderOverOdds == null) {
                        game.UnderOverOdds = {
                            Under: "N/A",
                            Over: "N/A",
                            ExtraValue: "N/A"
                        };
                    }
                    var rowTemplate = ' <tr  data-symbol="' + game.MatchNo + '" id="' + game.MatchNo + '"> ' +

                                ' <td data-field="shortCode" class="short-code"> '+ game.ShortCode +' </td> ' +
                                ' <td data-field="matchId" class="match-code hidden">'+game.MatchNo +'</td> ' +
                                ' <td data-field="startTime" class="start-time">'+ game.Minutes +'</td> ' +
                                ' <td data-field="startDate" class="start-date hidden"> '+ game.StartDate+'</td> ' +
                                ' <td data-field="teamVersus" class="team-versus hidden">'+ game.LocalTeam +'  vs  '+ game.AwayTeam+'</td> ' +
                                ' <td>'+ game.LocalTeam +'</td> ' +
                                ' <td data-field="liveScores" class="live-scores">'+ game.LocalTeamScore +' - '+ game.AwayTeamScore +'</td> ' +
                                ' <td>'+ game.AwayTeam +'</td> ' +
                                ' <td style="padding-bottom: 0px;"> ' +
                                     ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+ game.FullTimeOdds.HomeWins +'" data-odd-type="Live" data-option-id="80" data-option-name=1" data-bet-category="FT1X2" /> ' +
                                    
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+ game.FullTimeOdds.Draw +'" data-odd-type="Live" data-option-id="81" data-option-name="X" data-bet-category="FT1X2" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+ game.FullTimeOdds.AwayWins +'" data-odd-type="Live" data-option-id="83" data-option-name="2" data-bet-category="FT1X2" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default odd" value="'+ game.UnderOverOdds.Under +'" data-odd-type="Live" data-option-id="78" data-option-name="U" data-bet-category="U/O" /> ' +
                    '  </td> ' +
                     '<td id="' + game.MatchNo + '" data-extra-value="' + game.UnderOverOdds.ExtraValue + '"  style="padding-top: 14px;">' +
                                '  <span class="extra-value" style="color:#E9860D;">' + game.UnderOverOdds.ExtraValue + '</span>' +
                                '</td>' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default odd" value="'+ game.UnderOverOdds.Over +'" data-odd-type="Live" data-option-id="79" data-option-name="O" data-bet-category="U/O" /> ' +
                    '  </td> ' +
                     ' <td style="padding-bottom: 0px;"> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+game.DoubleChance.HomeWinsOrDraw+'" data-odd-type="Live" data-option-id="74" data-option-name="1X" data-bet-category="Double Chance" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+game.DoubleChance.HomeWinsOrAwayWins+'" data-odd-type="Live" data-option-id="71" data-option-name="12" data-bet-category="Double Chance" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+game.DoubleChance.AwayWinsOrDraw+'" data-odd-type="Live" data-option-id="77" data-option-name="X2" data-bet-category="Double Chance" /> ' +
                    '  </td> ' +
                     ' <td style="padding-bottom: 0px;"> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-1 odd" value="'+game.NextGoal.HomeScores+'" data-odd-type="Live" data-option-id="71" data-option-name="H-GOAL" data-bet-category="FT1X2-NG" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-X odd" value="'+game.NextGoal.Draw+'" data-odd-type="Live" data-option-id="72" data-option-name="NG" data-bet-category="FT1X2-NG" /> ' +
                    '  </td> ' +
                     ' <td> ' +
                         ' <input type="button" class="btn btn-sm btn-default FT-2 odd" value="'+game.NextGoal.AwayScores+'" data-odd-type="Live" data-option-id="73" data-option-name="A-GOAL" data-bet-category="FT1X2-NG" /> ' +
                    '  </td> ' +
                ' </tr> ';
                    var FT1 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.FT-1').attr("value");
                    var FTX = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.FT-X').attr("value");
                    var FT2 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.FT-2').attr("value");
                    
                    var under = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.under').attr("value");
                    var over = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.over').attr("value");
                    
                    var RM1 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.RM-1').attr("value");
                    var RMX = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.RM-X').attr("value");
                    var RM2 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.RM-2').attr("value");
                    
                    var NG1 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.NG-1').attr("value");
                    var NGX = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.NG-X').attr("value");
                    var NG2 = $gamesTableBody.find('#' + game.MatchNo + ' > td > input.NG-2').attr("value");

                    // full time
                    if ($gamesTableBody.find('tr[id=' + game.MatchNo + ']').length > 0) {
                        $gamesTableBody.find('tr[id=' + game.MatchNo + ']')
                            .replaceWith(rowTemplate);
                    } else {
                        $gamesTableBody.append(rowTemplate);
                    }
                    if (parseInt(FT1) > parseInt(game.FullTimeOdds.HomeWins)) {
                        $('#' + game.MatchNo + ' > td > input.FT-1').addTemporaryClass("down", 3000);

                    }
                    if (parseInt(FT1) < parseInt(game.FullTimeOdds.HomeWins)) {
                        $('#' + game.MatchNo + ' > td > input.FT-1').addTemporaryClass("up", 3000);
                    }
                    if (parseInt(FTX) > parseInt(game.FullTimeOdds.Draw)) {
                        $('#' + game.MatchNo + ' > td > input.FT-X').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(FTX) < parseInt(game.FullTimeOdds.Draw)) {
                        $('#' + game.MatchNo + ' > td > input.FT-X').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    if (parseInt(FT2) > parseInt(game.FullTimeOdds.AwayWins)) {
                        $('#' + game.MatchNo + ' > td > input.FT-2').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(FT2) < parseInt(game.FullTimeOdds.AwayWins)) {
                        $('#' + game.MatchNo + ' > td > input.FT-2').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    
                    // under/over
                    if (parseInt(under) > parseInt(game.UnderOverOdds.Under)) {
                        $('#' + game.MatchNo + ' > td > input.under').addTemporaryClass("down", 3000);

                    }
                    if (parseInt(under) < parseInt(game.UnderOverOdds.Under)) {
                        $('#' + game.MatchNo + ' > td > input.under').addTemporaryClass("up", 3000);
                    }
                    if (parseInt(over) > parseInt(game.UnderOverOdds.Over)) {
                        $('#' + game.MatchNo + ' > td > input.over').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(over) < parseInt(game.UnderOverOdds.Over)) {
                        $('#' + game.MatchNo + ' > td > input.over').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    
                    // rest of match
                    if (parseInt(RM1) > parseInt(game.DoubleChance.HomeWinsOrDraw)) {
                        $('#' + game.MatchNo + ' > td > input.RM-1').addTemporaryClass("down", 3000);

                    }
                    if (parseInt(RM1) < parseInt(game.DoubleChance.HomeWinsOrDraw)) {
                        $('#' + game.MatchNo + ' > td > input.RM-1').addTemporaryClass("up", 3000);
                    }
                    if (parseInt(RMX) > parseInt(game.DoubleChance.HomeWinsOrAwayWins)) {
                        $('#' + game.MatchNo + ' > td > input.RM-X').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(RMX) < parseInt(game.DoubleChance.HomeWinsOrAwayWins)) {
                        $('#' + game.MatchNo + ' > td > input.RM-X').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    if (parseInt(RM2) > parseInt(game.DoubleChance.AwayWinsOrDraw)) {
                        $('#' + game.MatchNo + ' > td > input.RM-2').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(RM2) < parseInt(game.DoubleChance.AwayWinsOrDraw)) {
                        $('#' + game.MatchNo + ' > td > input.RM-2').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    
                    // next goal
                    if (parseInt(NG1) > parseInt(game.NextGoal.HomeScores)) {
                        $('#' + game.MatchNo + ' > td > input.NG-1').addTemporaryClass("down", 3000);

                    }
                    if (parseInt(NG1) < parseInt(game.NextGoal.HomeScores)) {
                        $('#' + game.MatchNo + ' > td > input.NG-1').addTemporaryClass("up", 3000);
                    }
                    if (parseInt(NGX) > parseInt(game.NextGoal.Draw)) {
                        $('#' + game.MatchNo + ' > td > input.NG-X').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(NGX) < parseInt(game.NextGoal.Draw)) {
                        $('#' + game.MatchNo + ' > td > input.NG-X').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                    if (parseInt(NG2) > parseInt(game.NextGoal.AwayScores)) {
                        $('#' + game.MatchNo + ' > td > input.NG-2').addTemporaryClass("down", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' down');

                    }
                    if (parseInt(NG2) < parseInt(game.NextGoal.AwayScores)) {
                        $('#' + game.MatchNo + ' > td > input.NG-2').addTemporaryClass("up", 3000);
                        console.log(FT1 + ' ' + FTX + ' ' + FT2 + ' up');
                    }
                };
                // Start the connection
                $.connection.hub.start().done(init);

            });
        })

    </script>}